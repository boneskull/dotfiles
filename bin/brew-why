#!/usr/bin/env bash

# from https://github.com/nicknisi/dotfiles/blob/e15dc3c0a0fa6e137dee615eb7a5e224bf6d2355/bin/brew-why

# List out all installed apps along with all the apps each app is dependent on.
# Usage: brew-why [package]
#   If package is provided, show only the "why" for that package.
#   Otherwise, show the "why" for all installed formulae.

# Trap SIGINT (Ctrl-C) to exit cleanly
trap 'echo; exit 130' INT

show_why() {
    local pkg="$1"
    echo -ne "\x1B[1;34m $pkg \x1B[0m"
    brew uses "$pkg" --installed | awk '{printf(" %s ", $0)}'
    echo ""
}

if [[ -n "$1" ]]; then
    # Single package mode
    show_why "$1"
else
    # All packages mode
    while read -r cask; do
        show_why "$cask"
    done < <(brew list -1 --formula)
fi
